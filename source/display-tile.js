// Context
var gl;

var tile = '[{"points": [], "type": 1133}, {"points": [{"y": 0.866092, "x": -13.5892, "z": 39.5471, "u": 31, "v": 159}, {"y": 0.42784, "x": -13.6029, "z": 39.5411, "u": 92, "v": 295}, {"y": 0.417621, "x": -13.5919, "z": 39.541, "u": 96, "v": 297}, {"y": 0.258881, "x": -13.5842, "z": 39.539, "u": 120, "v": 343}, {"y": 1.05576, "x": -13.5849, "z": 39.5496, "u": 2, "v": 97}, {"y": 1.04845, "x": -13.5898, "z": 39.5495, "u": 2, "v": 100}], "type": 6}, {"points": [{"y": 1.28288, "x": -13.4335, "z": 39.5538, "u": 1, "v": 0}, {"y": 1.28402, "x": -13.4366, "z": 39.5538, "u": 0, "v": 0}, {"y": 0.0937207, "x": -13.2234, "z": 39.5395, "u": 230, "v": 360}, {"y": 1.05828, "x": -13.5667, "z": 39.5498, "u": 6, "v": 94}, {"y": -0.703942, "x": -12.9693, "z": 39.5308, "u": 401, "v": 570}, {"y": 1.05586, "x": -13.5683, "z": 39.5498, "u": 6, "v": 95}, {"y": 0.258881, "x": -13.5842, "z": 39.539, "u": 120, "v": 343}, {"y": 1.05576, "x": -13.5849, "z": 39.5496, "u": 2, "v": 97}], "type": 5}, {"points": [{"y": 1.28402, "x": -13.4366, "z": 39.5538, "u": 0, "v": 0}, {"y": 1.063, "x": -13.5882, "z": 39.5497, "u": 0, "v": 95}, {"y": 1.06181, "x": -13.5849, "z": 39.5497, "u": 1, "v": 95}, {"y": 1.06908, "x": -13.58, "z": 39.5498, "u": 1, "v": 92}, {"y": 1.05828, "x": -13.5667, "z": 39.5498, "u": 6, "v": 94}], "type": 6}, {"points": [{"y": -0.712475, "x": -13.5178, "z": 39.5265, "u": 265, "v": 603}, {"y": -0.716041, "x": -13.5198, "z": 39.5264, "u": 265, "v": 604}, {"y": -0.784672, "x": -13.4759, "z": 39.5258, "u": 284, "v": 619}, {"y": -0.706886, "x": -13.5839, "z": 39.526, "u": 249, "v": 605}, {"y": -0.788508, "x": -13.5988, "z": 39.5248, "u": 256, "v": 626}, {"y": -0.719668, "x": -13.5998, "z": 39.5257, "u": 247, "v": 609}, {"y": -0.771547, "x": -13.6025, "z": 39.525, "u": 253, "v": 622}, {"y": -0.708466, "x": -13.6154, "z": 39.5258, "u": 242, "v": 607}, {"y": -0.759545, "x": -13.6221, "z": 39.525, "u": 247, "v": 620}, {"y": -0.717296, "x": -13.6512, "z": 39.5254, "u": 235, "v": 611}, {"y": -0.723748, "x": -13.6593, "z": 39.5252, "u": 234, "v": 613}], "type": 5}, {"points": [{"y": -0.759545, "x": -13.6221, "z": 39.525, "u": 247, "v": 620}, {"y": -0.723748, "x": -13.6593, "z": 39.5252, "u": 234, "v": 613}, {"y": -0.722947, "x": -13.6633, "z": 39.5252, "u": 233, "v": 613}, {"y": -0.726581, "x": -13.6654, "z": 39.5251, "u": 233, "v": 614}, {"y": -0.72578, "x": -13.6694, "z": 39.5251, "u": 232, "v": 614}, {"y": -0.729419, "x": -13.6714, "z": 39.5251, "u": 232, "v": 615}, {"y": -0.728619, "x": -13.6754, "z": 39.525, "u": 231, "v": 615}, {"y": -0.732263, "x": -13.6775, "z": 39.525, "u": 231, "v": 616}, {"y": -0.731462, "x": -13.6815, "z": 39.525, "u": 230, "v": 616}, {"y": -0.735112, "x": -13.6836, "z": 39.5249, "u": 230, "v": 617}, {"y": -0.734312, "x": -13.6876, "z": 39.5249, "u": 229, "v": 617}, {"y": -0.737966, "x": -13.6897, "z": 39.5248, "u": 229, "v": 618}, {"y": -0.737166, "x": -13.6937, "z": 39.5248, "u": 228, "v": 618}, {"y": -0.740825, "x": -13.6958, "z": 39.5247, "u": 228, "v": 619}, {"y": -0.744488, "x": -13.6979, "z": 39.5247, "u": 228, "v": 620}], "type": 6}, {"points": [{"y": -0.740026, "x": -13.6998, "z": 39.5247, "u": 227, "v": 619}, {"y": -0.74369, "x": -13.7019, "z": 39.5246, "u": 227, "v": 620}, {"y": -0.748156, "x": -13.7, "z": 39.5246, "u": 228, "v": 621}, {"y": -0.744488, "x": -13.6979, "z": 39.5247, "u": 228, "v": 620}, {"y": -0.740825, "x": -13.6958, "z": 39.5247, "u": 228, "v": 619}], "type": 6}, {"points": [{"y": -0.742891, "x": -13.7059, "z": 39.5246, "u": 226, "v": 620}, {"y": -0.74656, "x": -13.708, "z": 39.5245, "u": 226, "v": 621}, {"y": -0.748156, "x": -13.7, "z": 39.5246, "u": 228, "v": 621}, {"y": -0.74369, "x": -13.7019, "z": 39.5246, "u": 227, "v": 620}], "type": 6}, {"points": [{"y": -0.733024, "x": -13.2506, "z": 39.5283, "u": 332, "v": 594}, {"y": -0.736497, "x": -13.2524, "z": 39.5282, "u": 332, "v": 595}, {"y": -0.820276, "x": -12.7768, "z": 39.5308, "u": 468, "v": 590}, {"y": -0.73691, "x": -13.2687, "z": 39.5281, "u": 328, "v": 596}, {"y": -0.795891, "x": -13.3029, "z": 39.527, "u": 327, "v": 613}, {"y": -0.72967, "x": -13.3588, "z": 39.5275, "u": 305, "v": 599}, {"y": -0.783789, "x": -13.3623, "z": 39.5267, "u": 311, "v": 613}, {"y": -0.793731, "x": -13.3717, "z": 39.5265, "u": 310, "v": 616}], "type": 5}, {"points": [{"y": -0.793731, "x": -13.3717, "z": 39.5265, "u": 310, "v": 616}, {"y": -0.72967, "x": -13.3588, "z": 39.5275, "u": 305, "v": 599}, {"y": -0.720715, "x": -13.383, "z": 39.5274, "u": 298, "v": 598}, {"y": -0.709751, "x": -13.4357, "z": 39.5271, "u": 284, "v": 598}, {"y": -0.71328, "x": -13.4376, "z": 39.5271, "u": 284, "v": 599}, {"y": -0.70423, "x": -13.4622, "z": 39.527, "u": 277, "v": 598}, {"y": -0.71406, "x": -13.4718, "z": 39.5268, "u": 276, "v": 601}, {"y": -0.784672, "x": -13.4759, "z": 39.5258, "u": 284, "v": 619}], "type": 6}, {"points": [{"y": -0.784672, "x": -13.4759, "z": 39.5258, "u": 284, "v": 619}, {"y": -0.71406, "x": -13.4718, "z": 39.5268, "u": 276, "v": 601}, {"y": -0.709321, "x": -13.4947, "z": 39.5267, "u": 270, "v": 601}, {"y": -0.712874, "x": -13.4966, "z": 39.5266, "u": 270, "v": 602}, {"y": -0.712475, "x": -13.5178, "z": 39.5265, "u": 265, "v": 603}], "type": 6}, {"points": [{"y": -0.718383, "x": -13.2835, "z": 39.5282, "u": 322, "v": 592}, {"y": -0.710671, "x": -13.2836, "z": 39.5283, "u": 321, "v": 590}, {"y": -0.709895, "x": -13.2872, "z": 39.5283, "u": 320, "v": 590}, {"y": -0.713364, "x": -13.289, "z": 39.5282, "u": 320, "v": 591}, {"y": -0.711407, "x": -13.3164, "z": 39.528, "u": 313, "v": 592}, {"y": -0.719149, "x": -13.3164, "z": 39.5279, "u": 314, "v": 594}, {"y": -0.720699, "x": -13.2725, "z": 39.5283, "u": 325, "v": 592}, {"y": -0.721088, "x": -13.2526, "z": 39.5284, "u": 330, "v": 591}], "type": 6}, {"points": [{"y": -0.733024, "x": -13.2506, "z": 39.5283, "u": 332, "v": 594}, {"y": -0.820276, "x": -12.7768, "z": 39.5308, "u": 468, "v": 590}, {"y": -0.718399, "x": -13.2472, "z": 39.5285, "u": 331, "v": 590}, {"y": -0.717628, "x": -13.2508, "z": 39.5285, "u": 330, "v": 590}, {"y": -0.721088, "x": -13.2526, "z": 39.5284, "u": 330, "v": 591}, {"y": -0.720699, "x": -13.2725, "z": 39.5283, "u": 325, "v": 592}, {"y": -0.724171, "x": -13.2743, "z": 39.5282, "u": 325, "v": 593}], "type": 6}, {"points": [{"y": -0.75252, "x": -12.2947, "z": 39.5354, "u": 603, "v": 539}, {"y": -0.711259, "x": -12.464, "z": 39.5346, "u": 546, "v": 539}, {"y": -0.810558, "x": -12.4265, "z": 39.5336, "u": 569, "v": 565}, {"y": -0.811652, "x": -12.3196, "z": 39.5344, "u": 602, "v": 558}, {"y": -0.804015, "x": -12.2657, "z": 39.5349, "u": 618, "v": 552}, {"y": -0.765216, "x": -12.2707, "z": 39.5354, "u": 612, "v": 541}, {"y": -0.712004, "x": -12.2673, "z": 39.5362, "u": 607, "v": 525}, {"y": -0.704949, "x": -12.3091, "z": 39.5359, "u": 593, "v": 526}, {"y": -0.710405, "x": -12.3143, "z": 39.5358, "u": 592, "v": 528}, {"y": -0.70968, "x": -12.3173, "z": 39.5358, "u": 591, "v": 528}, {"y": -0.712775, "x": -12.3184, "z": 39.5358, "u": 591, "v": 529}, {"y": -0.725186, "x": -12.323, "z": 39.5356, "u": 591, "v": 533}], "type": 6}, {"points": [{"y": -0.725186, "x": -12.323, "z": 39.5356, "u": 591, "v": 533}, {"y": -0.712775, "x": -12.3184, "z": 39.5358, "u": 591, "v": 529}, {"y": -0.705326, "x": -12.3348, "z": 39.5357, "u": 585, "v": 528}, {"y": -0.716286, "x": -12.3453, "z": 39.5355, "u": 583, "v": 532}, {"y": -0.707046, "x": -12.3968, "z": 39.5352, "u": 566, "v": 533}, {"y": -0.712564, "x": -12.4022, "z": 39.5351, "u": 565, "v": 535}, {"y": -0.714964, "x": -12.4063, "z": 39.535, "u": 564, "v": 536}], "type": 6}, {"points": [{"y": -0.778607, "x": -12.2439, "z": 39.5354, "u": 622, "v": 543}, {"y": -0.765216, "x": -12.2707, "z": 39.5354, "u": 612, "v": 541}, {"y": -0.804015, "x": -12.2657, "z": 39.5349, "u": 618, "v": 552}, {"y": -0.791131, "x": -12.2484, "z": 39.5352, "u": 622, "v": 547}], "type": 6}, {"points": [{"y": -0.810558, "x": -12.4265, "z": 39.5336, "u": 569, "v": 565}, {"y": -0.711259, "x": -12.464, "z": 39.5346, "u": 546, "v": 539}, {"y": -0.716829, "x": -12.4694, "z": 39.5345, "u": 545, "v": 541}, {"y": -0.717063, "x": -12.5261, "z": 39.5341, "u": 528, "v": 545}, {"y": -0.709732, "x": -12.5568, "z": 39.5339, "u": 518, "v": 545}, {"y": -0.717603, "x": -12.5973, "z": 39.5335, "u": 507, "v": 550}, {"y": -0.725298, "x": -12.6244, "z": 39.5332, "u": 500, "v": 554}, {"y": -0.715456, "x": -12.6513, "z": 39.5331, "u": 491, "v": 553}, {"y": -0.723942, "x": -12.6757, "z": 39.5328, "u": 485, "v": 557}, {"y": -0.721124, "x": -12.734, "z": 39.5324, "u": 468, "v": 560}, {"y": -0.820276, "x": -12.7768, "z": 39.5308, "u": 468, "v": 590}], "type": 6}, {"points": [{"y": -0.820276, "x": -12.7768, "z": 39.5308, "u": 468, "v": 590}, {"y": -0.721124, "x": -12.734, "z": 39.5324, "u": 468, "v": 560}, {"y": -0.711019, "x": -12.7934, "z": 39.5321, "u": 450, "v": 561}, {"y": -0.725181, "x": -12.8104, "z": 39.5318, "u": 447, "v": 566}, {"y": -0.712199, "x": -12.8516, "z": 39.5316, "u": 434, "v": 565}, {"y": -0.718046, "x": -12.8578, "z": 39.5315, "u": 433, "v": 567}, {"y": -0.712058, "x": -12.8843, "z": 39.5314, "u": 425, "v": 567}, {"y": -0.718998, "x": -12.9021, "z": 39.5312, "u": 421, "v": 570}, {"y": -0.722319, "x": -12.9036, "z": 39.5311, "u": 421, "v": 571}, {"y": -0.70772, "x": -12.9524, "z": 39.5309, "u": 406, "v": 570}, {"y": -0.720649, "x": -12.9771, "z": 39.5305, "u": 401, "v": 575}, {"y": -0.712772, "x": -12.9959, "z": 39.5305, "u": 395, "v": 574}, {"y": -0.718726, "x": -13.0025, "z": 39.5304, "u": 394, "v": 576}, {"y": -0.717971, "x": -13.0059, "z": 39.5304, "u": 393, "v": 576}, {"y": -0.721332, "x": -13.0075, "z": 39.5303, "u": 393, "v": 577}, {"y": -0.713009, "x": -13.0452, "z": 39.5301, "u": 382, "v": 577}, {"y": -0.718943, "x": -13.0864, "z": 39.5297, "u": 372, "v": 581}, {"y": -0.722337, "x": -13.088, "z": 39.5297, "u": 372, "v": 582}, {"y": -0.713962, "x": -13.1265, "z": 39.5295, "u": 361, "v": 582}, {"y": -0.712434, "x": -13.1336, "z": 39.5294, "u": 359, "v": 582}, {"y": -0.715842, "x": -13.1352, "z": 39.5294, "u": 359, "v": 583}, {"y": -0.709719, "x": -13.1635, "z": 39.5293, "u": 351, "v": 583}, {"y": -0.715792, "x": -13.1704, "z": 39.5291, "u": 350, "v": 585}, {"y": -0.715025, "x": -13.174, "z": 39.5291, "u": 349, "v": 585}, {"y": -0.718452, "x": -13.1757, "z": 39.529, "u": 349, "v": 586}, {"y": -0.717686, "x": -13.1793, "z": 39.529, "u": 348, "v": 586}, {"y": -0.721117, "x": -13.181, "z": 39.529, "u": 348, "v": 587}, {"y": -0.709588, "x": -13.2347, "z": 39.5287, "u": 333, "v": 587}, {"y": -0.715714, "x": -13.2418, "z": 39.5286, "u": 332, "v": 589}, {"y": -0.714943, "x": -13.2455, "z": 39.5285, "u": 331, "v": 589}, {"y": -0.718399, "x": -13.2472, "z": 39.5285, "u": 331, "v": 590}], "type": 6}, {"points": [{"y": -0.820276, "x": -12.7768, "z": 39.5308, "u": 468, "v": 590}, {"y": -0.795891, "x": -13.3029, "z": 39.527, "u": 327, "v": 613}, {"y": -0.802992, "x": -13.3066, "z": 39.5269, "u": 327, "v": 615}, {"y": -0.805978, "x": -13.3698, "z": 39.5264, "u": 312, "v": 619}, {"y": -0.803341, "x": -13.5031, "z": 39.5254, "u": 280, "v": 625}, {"y": -0.813634, "x": -13.5952, "z": 39.5245, "u": 260, "v": 632}], "type": 6}, {"points": [{"y": -0.800097, "x": -13.6228, "z": 39.5245, "u": 252, "v": 630}, {"y": -0.811935, "x": -13.625, "z": 39.5243, "u": 253, "v": 633}, {"y": -0.813634, "x": -13.5952, "z": 39.5245, "u": 260, "v": 632}, {"y": -0.803341, "x": -13.5031, "z": 39.5254, "u": 280, "v": 625}], "type": 6}, {"points": [{"y": 0.867187, "x": -13.2092, "z": 39.55, "u": 125, "v": 114}, {"y": 0.974194, "x": -13.2092, "z": 39.5514, "u": 109, "v": 78}, {"y": 0.849808, "x": -13.2191, "z": 39.5497, "u": 125, "v": 121}, {"y": 1.28288, "x": -13.4335, "z": 39.5538, "u": 1, "v": 0}, {"y": 0.446034, "x": -13.2255, "z": 39.5442, "u": 181, "v": 252}, {"y": 0.0937207, "x": -13.2234, "z": 39.5395, "u": 230, "v": 360}, {"y": 0.403722, "x": -13.2132, "z": 39.5438, "u": 190, "v": 264}], "type": 5}, {"points": [{"y": 0.826321, "x": -12.267, "z": 39.5568, "u": 408, "v": 0}, {"y": 1.28288, "x": -13.4335, "z": 39.5538, "u": 1, "v": 0}, {"y": 0.969734, "x": -12.6903, "z": 39.5554, "u": 254, "v": 9}, {"y": 0.879592, "x": -12.6871, "z": 39.5542, "u": 268, "v": 41}, {"y": 0.873781, "x": -12.6865, "z": 39.5541, "u": 269, "v": 43}, {"y": 0.82587, "x": -12.686, "z": 39.5535, "u": 276, "v": 60}, {"y": 0.463052, "x": -12.3529, "z": 39.5512, "u": 430, "v": 145}, {"y": 0.46792, "x": -12.3508, "z": 39.5513, "u": 430, "v": 143}, {"y": 0.463578, "x": -12.3465, "z": 39.5513, "u": 432, "v": 144}, {"y": 0.463077, "x": -12.2827, "z": 39.5518, "u": 453, "v": 136}, {"y": 0.468969, "x": -12.2682, "z": 39.552, "u": 457, "v": 132}], "type": 6}, {"points": [{"y": 0.463052, "x": -12.3529, "z": 39.5512, "u": 430, "v": 145}, {"y": 0.82587, "x": -12.686, "z": 39.5535, "u": 276, "v": 60}, {"y": -0.69878, "x": -12.3613, "z": 39.5356, "u": 576, "v": 528}, {"y": 0.0884559, "x": -12.6982, "z": 39.5435, "u": 374, "v": 312}, {"y": -0.703942, "x": -12.9693, "z": 39.5308, "u": 401, "v": 570}, {"y": 0.0905718, "x": -13.2014, "z": 39.5397, "u": 236, "v": 359}, {"y": 0.091574, "x": -13.2048, "z": 39.5397, "u": 235, "v": 359}], "type": 5}, {"points": [{"y": 0.0887009, "x": -13.2064, "z": 39.5396, "u": 235, "v": 360}, {"y": 0.0937207, "x": -13.2234, "z": 39.5395, "u": 230, "v": 360}, {"y": -0.703942, "x": -12.9693, "z": 39.5308, "u": 401, "v": 570}, {"y": 0.091574, "x": -13.2048, "z": 39.5397, "u": 235, "v": 359}], "type": 6}, {"points": [{"y": -0.703942, "x": -12.9693, "z": 39.5308, "u": 401, "v": 570}, {"y": 0.258881, "x": -13.5842, "z": 39.539, "u": 120, "v": 343}, {"y": 0.253058, "x": -13.5877, "z": 39.5389, "u": 120, "v": 345}, {"y": 0.256362, "x": -13.5987, "z": 39.5388, "u": 117, "v": 345}, {"y": 0.230772, "x": -13.6054, "z": 39.5384, "u": 119, "v": 353}, {"y": -0.694458, "x": -13.6251, "z": 39.5259, "u": 238, "v": 604}], "type": 6}, {"points": [{"y": 0.472423, "x": -13.2189, "z": 39.5447, "u": 179, "v": 243}, {"y": 0.849808, "x": -13.2191, "z": 39.5497, "u": 125, "v": 121}, {"y": 0.446034, "x": -13.2255, "z": 39.5442, "u": 181, "v": 252}, {"y": 0.879592, "x": -12.6871, "z": 39.5542, "u": 268, "v": 41}, {"y": 0.969734, "x": -12.6903, "z": 39.5554, "u": 254, "v": 9}, {"y": 0.935138, "x": -12.6937, "z": 39.5549, "u": 258, "v": 22}, {"y": 0.873781, "x": -12.6865, "z": 39.5541, "u": 269, "v": 43}, {"y": 0.879592, "x": -12.6871, "z": 39.5542, "u": 268, "v": 41}, {"y": 0.87599, "x": -12.6922, "z": 39.5541, "u": 267, "v": 43}, {"y": 0.969734, "x": -12.6903, "z": 39.5554, "u": 254, "v": 9}, {"y": 1.28288, "x": -13.4335, "z": 39.5538, "u": 1, "v": 0}, {"y": 0.974194, "x": -13.2092, "z": 39.5514, "u": 109, "v": 78}, {"y": -0.803341, "x": -13.5031, "z": 39.5254, "u": 280, "v": 625}, {"y": -0.805978, "x": -13.3698, "z": 39.5264, "u": 312, "v": 619}, {"y": -0.796843, "x": -13.4953, "z": 39.5255, "u": 281, "v": 623}, {"y": -0.805978, "x": -13.3698, "z": 39.5264, "u": 312, "v": 619}, {"y": -0.802992, "x": -13.3066, "z": 39.5269, "u": 327, "v": 615}, {"y": -0.799575, "x": -13.3623, "z": 39.5265, "u": 313, "v": 617}, {"y": -0.73691, "x": -13.2687, "z": 39.5281, "u": 328, "v": 596}, {"y": -0.736497, "x": -13.2524, "z": 39.5282, "u": 332, "v": 595}, {"y": -0.73343, "x": -13.2669, "z": 39.5281, "u": 328, "v": 595}, {"y": -0.713962, "x": -13.1265, "z": 39.5295, "u": 361, "v": 582}, {"y": -0.722337, "x": -13.088, "z": 39.5297, "u": 372, "v": 582}, {"y": -0.71056, "x": -13.1249, "z": 39.5295, "u": 361, "v": 581}, {"y": -0.721124, "x": -12.734, "z": 39.5324, "u": 468, "v": 560}, {"y": -0.723942, "x": -12.6757, "z": 39.5328, "u": 485, "v": 557}, {"y": -0.715539, "x": -12.6965, "z": 39.5328, "u": 478, "v": 556}, {"y": -0.725298, "x": -12.6244, "z": 39.5332, "u": 500, "v": 554}, {"y": -0.717603, "x": -12.5973, "z": 39.5335, "u": 507, "v": 550}, {"y": -0.712197, "x": -12.6053, "z": 39.5335, "u": 504, "v": 549}, {"y": -0.811652, "x": -12.3196, "z": 39.5344, "u": 602, "v": 558}, {"y": -0.810558, "x": -12.4265, "z": 39.5336, "u": 569, "v": 565}, {"y": -0.814832, "x": -12.3207, "z": 39.5344, "u": 602, "v": 559}, {"y": -0.714964, "x": -12.4063, "z": 39.535, "u": 564, "v": 536}, {"y": -0.712564, "x": -12.4022, "z": 39.5351, "u": 565, "v": 535}, {"y": -0.711836, "x": -12.4051, "z": 39.5351, "u": 564, "v": 535}, {"y": -0.788508, "x": -13.5988, "z": 39.5248, "u": 256, "v": 626}, {"y": -0.771547, "x": -13.6025, "z": 39.525, "u": 253, "v": 622}, {"y": -0.786177, "x": -13.6106, "z": 39.5248, "u": 253, "v": 626}, {"y": -0.709751, "x": -13.4357, "z": 39.5271, "u": 284, "v": 598}, {"y": -0.720715, "x": -13.383, "z": 39.5274, "u": 298, "v": 598}, {"y": -0.712911, "x": -13.3831, "z": 39.5275, "u": 297, "v": 596}, {"y": 0.258881, "x": -13.5842, "z": 39.539, "u": 120, "v": 343}, {"y": 0.417621, "x": -13.5919, "z": 39.541, "u": 96, "v": 297}, {"y": 0.26911, "x": -13.5953, "z": 39.539, "u": 116, "v": 341}], "type": 4}]';


var vertexBuffer = [];
// var textureBuffer = [];
// var imageTextures = Object.create({});//Object used to store image data already loaded from server; used for memoiziation

// Transformation Matrices
var mvMatrix = mat4.create();
var mvMatrixStack = [];
var pMatrix = mat4.create();

// Shader Program
var shaderProgram;

// Animation Variables
var cameraPosition = {
	xPos: -11.45,
	yPos: 0.4,
	zPos: 42.042168
}

var oldCameraPosition = Object.create(cameraPosition);

var pitch = 0;
var pitchRate = 0;
var yaw = 0;
var yawRate = 0;
var speed = 0;
var lastTime = 0;

// User Key Presses
var currentlyPressedKeys = {};
// Typemap for rendering data
var typeMap;
// AJAX Variable
var bufferDataFromServer = 0;

window.onload = function() {
	var canvas = document.getElementById("glCanvas");
	//startup();
	initGL(canvas);
	initShaders();

	getDataFromServer(tile);
	gl.clearColor(127.0/255.0, 140.0/255.0, 141.0/255.0, 0.4);
	gl.enable(gl.DEPTH_TEST);

	// document.onkeydown = handleKeyDown;
	// document.onkeyup = handleKeyUp;

	// var firstSVG = document.getElementById("jStickOne");
	// firstSVG.addEventListener("touchmove", handleLeftJoystickMove);
	// firstSVG.addEventListener("touchend", handleTouchEnd);

	// var secondSVG = document.getElementById("glCanvas");
	// secondSVG.addEventListener("touchmove", handleCanvasJoystickMove);
	// secondSVG.addEventListener("touchend", handleTouchEnd);
}

function initGL(canvas) {
	try {
		gl = canvas.getContext("webgl");
		gl.viewportWidth = canvas.width;
		gl.viewportHeight = canvas.height;
	} catch(e) {
		// Do nothing
	}

	if(!gl) {
		alert("Error: Could not initialize WebGL");
	}

	typeMap = [gl.POINTS,gl.LINES,gl.LINE_LOOP,gl.LINE_STRIP,gl.TRIANGLES,gl.TRIANGLE_STRIP,gl.TRIANGLE_FAN];
}

function initShaders() {
	var fragmentShader = getShader(gl, "shader-fs");
	var vertexShader = getShader(gl, "shader-vs");


	shaderProgram = gl.createProgram();
	gl.attachShader(shaderProgram, vertexShader);
	gl.attachShader(shaderProgram, fragmentShader);
	gl.linkProgram(shaderProgram);

	if(!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
		alert("Error: Could not initialize shaders");
	}

	gl.useProgram(shaderProgram);

	// Store some extra useful information with the shader program
	shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
	gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);

	shaderProgram.textureCoordAttribute = gl.getAttribLocation(shaderProgram, "aTextureCoord");
	gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);

	shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, "uPMatrix");
	shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, "uMVMatrix");
}

function getShader(gl, id) {
	var shaderScript = document.getElementById(id);
	if(!shaderScript) {
		console.log("No shader script")
		return null;
	}

	var str = "";
	var k = shaderScript.firstChild;
	while(k) {
		if(k.nodeType == 3)
			str += k.textContent;
		k = k.nextSibling;
	}

	var shader;
	if(shaderScript.type == "x-shader/x-fragment") {
		shader = gl.createShader(gl.FRAGMENT_SHADER);
	} else if(shaderScript.type == "x-shader/x-vertex") {
		shader = gl.createShader(gl.VERTEX_SHADER);
	} else {
		return null;
	}

	gl.shaderSource(shader, str);
	gl.compileShader(shader);

	if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
		alert(gl.getShaderInfoLog(shader));
		return null;
	}

	return shader;
}


function getDataFromServer(data) {
	// // Create the ajax request
	// jQuery.post(
	// 	"http://rns202-6.cs.stolaf.edu:1234",
	// 	{query: "SPECIAL:"},
		// function(data) {
	console.log("Going to parse data.");
	bufferDataFromServer = JSON.parse(data);
	console.log("Buffered Data");
			//initTexture();
		// });
}

function initBuffers() {

	bufferDataFromServer.forEach(function(tile, ind) {
		// Initialize the Square Buffer
		vertexBuffer[ind] = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer[ind]);

		var vertices = [];
		tile.points.forEach(function(val, ind) {
			vertices.push(val.x, val.y, val.z);
		})
		//console.log(vertices);
		gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);

		vertexBuffer[ind].itemSize = 3;
		vertexBuffer[ind].numItems = tile.points.length;
		vertexBuffer[ind].itemType = tile.type;

		// textureBuffer[ind] = gl.createBuffer();
		// gl.bindBuffer(gl.ARRAY_BUFFER, textureBuffer[ind]);

		// var textureCoords = [];
		// tile.points.forEach(function(val, ind){
		// 	textureCoords.push(val.u/imageTextures[bufferDataFromServer[ind].image].image.width, val.v/imageTextures[bufferDataFromServer[ind].image].image.height);
		// });
		// //console.log(textureCoords);
		// gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoords), gl.STATIC_DRAW);
		// textureBuffer[ind].itemSize = 2;
		// textureBuffer[ind].numItems = tile.points.length;
	});

	tick();
}

function tick() {
	requestAnimationFrame(tick);
	// handleKeys();
	drawScene();
	oldCameraPosition.xPos = cameraPosition.xPos;
	oldCameraPosition.zPos = cameraPosition.zPos;
	animate();
}